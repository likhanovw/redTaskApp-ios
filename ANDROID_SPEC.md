# ТЗ: Task Manager для Android (аналог iOS-приложения)

Сделай приложение «Менеджер задач» для Android — по функционалу оно должно совпадать с iOS-версией на SwiftUI + Core Data + MVVM. Ниже полное описание.

---

## Стек и требования

- **Язык:** Kotlin
- **UI:** Jetpack Compose (только Compose, без XML-разметки экранов)
- **Архитектура:** MVVM
- **Хранение данных:** Room
- **Минимальный API:** 26 (Android 8.0) или выше по усмотрению
- Без Swift/Kotlin Multiplatform — нативное Android-приложение

---

## Модели данных

### Task (задача)

- `id: UUID` (или Long/String — как принято в Room)
- `title: String` — обязательное
- `description: String?` — опциональное
- `isCompleted: Boolean`
- `order: Int` — для сортировки (в т.ч. drag-and-drop)
- `totalTimeSpent: Long` — суммарное время в секундах
- `createdAt: Long` (timestamp) или `Instant`/`LocalDateTime`
- `completedAt: Long?` — когда завершена (для архива)

### ChecklistItem (пункт чеклиста, вложен в задачу)

- `id: UUID` (или Long/String)
- `taskId: UUID` (или внешний ключ на Task)
- `title: String`
- `isCompleted: Boolean`
- `order: Int`

Связь: одна задача — много пунктов чеклиста. При удалении задачи удалять все её пункты. При удалении пункта — только пункт, задача остаётся.

---

## Экраны

### 1. Список активных задач (главный экран)

- Заголовок «Задачи», кнопка «+» для добавления задачи.
- Список задач: только `isCompleted == false`, сортировка по `order`.
- В каждой строке:
  - название задачи;
  - под ним: иконка чеклиста и текст «N/M» (сколько пунктов выполнено / всего);
  - если есть — «Текущая сессия: X» (только если для этой задачи запущен таймер);
  - строка «Общее время: X» (в человекочитаемом виде: часы, минуты, секунды).
- **Drag-and-drop** — перетаскивание для изменения порядка задач (обновлять `order` и сохранять в Room).
- **Свайп влево** — удалить задачу.
- **Свайп вправо** (или отдельное действие) — отметить задачу выполненной (`isCompleted = true`, `completedAt = now`).
- Тап по строке — переход на экран деталей задачи.

### 2. Детали задачи

- Редактирование названия и описания (поля ввода, сохранение в БД).
- Блок **Чеклист:**
  - отображение прогресса (N/M, можно ProgressBar);
  - список пунктов: чекбокс (выполнено/не выполнено), текст, кнопка удаления;
  - возможность удалять пункты (удаляется только пункт, не задача);
  - внизу — поле ввода + кнопка добавления нового пункта.
- Блок **Таймер:**
  - отображение «Текущая сессия: X» (пока таймер идёт);
  - «Всего времени: X» (уже накопленное + текущая сессия);
  - кнопка **Старт** / **Стоп** (одна кнопка, переключается по состоянию).
- Кнопка **«Завершить задачу»** — помечает задачу выполненной и возвращает в список (задача уходит в архив). Таймер при этом останавливать.
- При выходе с экрана (назад) таймер **не** останавливать — время продолжает идти.

### 3. Архив (выполненные задачи)

- Вклад или отдельный экран со списком задач, где `isCompleted == true`, сортировка по `completedAt` (новые сверху).
- В строке: название, дата/время завершения.
- Свайп влево — удалить навсегда.
- Свайп вправо (или кнопка) — «Восстановить» (вернуть в активные: `isCompleted = false`, `completedAt = null`, выставить `order`).

---

## Навигация и структура приложения

- Нижняя навигация (Bottom Navigation) или вкладки: **«Задачи»** (список активных) и **«Архив»** (выполненные).
- Список задач → по тапу открывается экран деталей (отдельный экран/Composable).
- Добавление задачи — экран или диалог с полями «Название» и «Описание» (опционально).

---

## Бизнес-логика (ViewModel / Use Cases)

- **Задачи:** создание, редактирование, удаление, «отметить выполненной», «восстановить», изменение порядка (после drag-and-drop).
- **Чеклист:** добавление пункта, переключение выполнен/не выполнен, удаление пункта, при необходимости — изменение порядка.
- **Таймер:**
  - в один момент может быть активен таймер только у одной задачи (по её id);
  - при Старт — запомнить задачу и время начала сессии, обновлять «текущая сессия» раз в секунду (или через Flow/StateFlow);
  - при Стоп — прибавить длительность сессии к `totalTimeSpent` задачи и сохранить в БД, сбросить активную сессию.
- **Локальные уведомления:** если таймер работает больше 2 часов — показать напоминание (через WorkManager или AlarmManager + NotificationManager): «Таймер работает уже больше 2 часов. Возможно, стоит сделать перерыв.»

---

## Важные детали (как на iOS)

1. Удаление **одного** пункта чеклиста не должно удалять задачу и не должно удалять остальные пункты. В Room это связь один-ко-многим с правильными `onDelete` (для задачи при удалении задачи — каскад на пункты; для пункта при удалении пункта — не удалять задачу).
2. При удалении пункта чеклиста пересчитывать `order` у оставшихся пунктов и сохранять.
3. Добавление пункта чеклиста и удаление пункта должны стабильно работать при запущенном таймере (без крашей и «пропажи» задачи).
4. Пульсации или сложной анимации у кнопки таймера не делать — достаточно смены цвета/текста Старт/Стоп.

---

## Что нужно сделать по шагам

1. **Room:** сущности `Task` и `ChecklistItem`, DAO (вставка, обновление, удаление, запросы по `isCompleted`, по `taskId` для пунктов), база с миграциями при необходимости.
2. **Repository слой** (опционально): обёртка над DAO для задач и чеклиста.
3. **ViewModel(’s):** для списка задач, для деталей задачи (с чеклистом и таймером), для архива — логика таймера (активная задача, текущая сессия в секундах), вызовы к БД.
4. **Экраны в Compose:** список активных задач (LazyColumn с drag-and-drop, свайпы), экран деталей (редактирование, чеклист, таймер, кнопка «Завершить»), архив, диалог/экран добавления задачи.
5. **Навигация:** Bottom Nav или табы между «Задачи» и «Архив», переход в детали по тапу.
6. **Уведомление о 2 часах таймера:** запланировать показ уведомления при старте таймера на 2 часа вперёд; отменить при остановке таймера.

Дай полную структуру проекта (пакеты, основные файлы), код на Kotlin + Compose + Room + MVVM и краткие пояснения, чтобы приложение можно было собрать и запустить в Android Studio.
